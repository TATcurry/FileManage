<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.jxufe.dao.mysql.FileMapper">
  <resultMap id="BaseResultMap" type="cn.jxufe.beans.model.File">
    <!--
      WARNING - @mbg.generated
    -->
    <id column="FILE_ID" jdbcType="BIGINT" property="fileId" />
    <result column="FILE_NAME" jdbcType="VARCHAR" property="fileName" />
    <result column="FILE_TYPE" jdbcType="VARCHAR" property="fileType" />
    <result column="FILE_SIZE" jdbcType="BIGINT" property="fileSize" />
    <result column="FILE_URL" jdbcType="VARCHAR" property="fileUrl" />
    <result column="IS_MARK" jdbcType="BIT" property="isMark" />
    <result column="IS_ACTIVE" jdbcType="BIT" property="isActive" />
    <result column="PARENT_URL" jdbcType="VARCHAR" property="parentUrl" />
    <result column="DEPT_ID" jdbcType="BIGINT" property="deptId" />
    <result column="USER_ID" jdbcType="BIGINT" property="userId" />
    <result column="CREATE_USER_ID" jdbcType="BIGINT" property="createUserId" />
    <result column="CREATE_DATE" jdbcType="TIMESTAMP" property="createDate" />
    <result column="MODIFY_USER_ID" jdbcType="BIGINT" property="modifyUserId" />
    <result column="MODIFY_DATE" jdbcType="TIMESTAMP" property="modifyDate" />
  </resultMap>

  <select id="findFileByParent" parameterType="cn.jxufe.beans.model.File" resultType="cn.jxufe.beans.model.File">
    select * from t_file
    where 1=1
    <if test="parentUrl != null">
      and parent_url = #{parentUrl}
    </if>
    and is_active = 1
    order by FIELD(file_type,'dir') desc
  </select>

  <select id="findFileHistoryList" parameterType="cn.jxufe.beans.model.File" resultType="cn.jxufe.beans.model.File">
    select * from t_file
    where 1=1
    <if test="parentUrl != null">
      and parent_url = #{parentUrl}
    </if>
    <if test="fileName != null">
      and file_name = #{fileName}
    </if>
    and is_active = 0
    order by modify_date desc
  </select>

  <update id="unableFileStatus" parameterType="cn.jxufe.beans.model.File">
    update t_file set is_active = 0
    where parent_url = #{parentUrl}
    and file_name = #{fileName}
    and is_active = 1
  </update>

  <select id="checkFileExist" parameterType="cn.jxufe.beans.model.File" resultType="cn.jxufe.beans.model.File">
    select * from t_file
    where parent_url = #{parentUrl}
    and file_name = #{fileName}
    and is_active = 1
  </select>

</mapper>